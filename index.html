<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Heart Disease Risk Prediction</title>

<style>
* { box-sizing: border-box; }

body {
    font-family: "Segoe UI", Arial, sans-serif;
    background: linear-gradient(135deg, #e0f7fa, #f4f7f6);
    margin: 0;
    padding: 0;
}

.container {
    max-width: 1100px;
    margin: auto;
    padding: 30px 20px;
}

h1 {
    text-align: center;
    margin-bottom: 25px;
    color: #2d3436;
}

form {
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    margin-bottom: 25px;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 16px;
}

.form-group {
    display: flex;
    flex-direction: column;
}

label {
    font-weight: 600;
    margin-bottom: 6px;
    font-size: 14px;
}

input, select {
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 14px;
}

input:focus, select:focus {
    outline: none;
    border-color: #0984e3;
    box-shadow: 0 0 0 2px rgba(9,132,227,0.15);
}

button {
    margin-top: 20px;
    background: #0984e3;
    color: white;
    border: none;
    padding: 14px;
    width: 100%;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    transition: background 0.3s;
}

button:hover {
    background: #74b9ff;
}

.results-section {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.08);
}

#messageContainer {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 10px;
}

#predictionDisplay h3 {
    margin-top: 10px;
    margin-bottom: 8px;
}

@media (max-width: 600px) {
    h1 { font-size: 22px; }
}
</style>
</head>

<body>
<div class="container">
<h1>Heart Disease Risk Prediction System</h1>

<form id="predictionForm">
    <div class="form-grid">

        <div class="form-group"><label>Age</label><input type="number" name="age" required></div>

        <div class="form-group"><label>Sex</label>
            <select name="sex" required>
                <option value="">Select</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
            </select>
        </div>

        <div class="form-group"><label>Chest Pain Type</label>
            <select name="cp" required>
                <option value="">Select</option>
                <option value="Typical Angina">Typical Angina</option>
                <option value="Atypical Angina">Atypical Angina</option>
                <option value="Non-Anginal Pain">Non-Anginal Pain</option>
                <option value="Asymptomatic">Asymptomatic</option>
            </select>
        </div>

        <div class="form-group"><label>Resting BP</label><input type="number" name="trestbps" required></div>

        <div class="form-group"><label>Cholesterol</label><input type="number" name="chol" required></div>

        <div class="form-group"><label>Fasting Blood Sugar >120 mg/dl</label>
            <select name="fbs" required>
                <option value="">Select</option>
                <option value="TRUE">Yes</option>
                <option value="FALSE">No</option>
            </select>
        </div>

        <div class="form-group"><label>Resting ECG</label>
            <select name="restecg" required>
                <option value="">Select</option>
                <option value="Normal">Normal</option>
                <option value="ST-T abnormality">ST-T abnormality</option>
                <option value="LV hypertrophy">LV hypertrophy</option>
            </select>
        </div>

        <div class="form-group"><label>Max Heart Rate Achieved</label><input type="number" name="thalach" required></div>

        <div class="form-group"><label>Exercise Induced Angina</label>
            <select name="exang" required>
                <option value="">Select</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
            </select>
        </div>

        <div class="form-group"><label>ST Depression (Oldpeak)</label><input type="number" step="0.1" name="oldpeak" required></div>

        <div class="form-group"><label>ST Slope</label>
            <select name="slope" required>
                <option value="">Select</option>
                <option value="Upsloping">Upsloping</option>
                <option value="Flat">Flat</option>
                <option value="Downsloping">Downsloping</option>
            </select>
        </div>

        <div class="form-group"><label>Number of Major Vessels</label><input type="number" name="ca" min="0" max="4" required></div>

        <div class="form-group"><label>Thalassemia</label>
            <select name="thal" required>
                <option value="">Select</option>
                <option value="Normal">Normal</option>
                <option value="Fixed Defect">Fixed Defect</option>
                <option value="Reversible Defect">Reversible Defect</option>
            </select>
        </div>

    </div>

    <button type="submit">Predict Risk Level</button>
</form>

<div class="results-section">
    <div id="messageContainer"></div>
    <div id="predictionDisplay"></div>
</div>

</div>

<script>
const form = document.getElementById('predictionForm');
form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const formData = new FormData(form);
    const data = {};
    for (let [key,value] of formData.entries()){
        if (['age','trestbps','chol','thalach','oldpeak','ca'].includes(key)){
            data[key] = parseFloat(value);
        } else if (key==='fbs'){
            data[key] = (value==='TRUE'||value==='true'||value==='1') ? 1 : 0;
        } else {
            data[key] = value;
        }
    }

    const messageContainer = document.getElementById('messageContainer');
    const predictionDisplay = document.getElementById('predictionDisplay');
    messageContainer.innerHTML = 'Analyzing...';
    predictionDisplay.innerHTML = '';

    try{
        const res = await fetch('/api/predict',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify(data)
        });
        const result = await res.json();
        if(result.success){
            const pred = result.prediction;
            messageContainer.innerHTML = `<strong>Prediction:</strong> ${pred.class_name} (${pred.risk_level})`;
            let probHTML = '<h3>Probabilities:</h3>';
            result.probabilities.forEach(p=>{
                probHTML+=`<div style="margin-bottom:5px;">${p.class_name}: ${p.probability.toFixed(1)}%</div>`;
            });
            predictionDisplay.innerHTML = probHTML;
        } else {
            messageContainer.innerHTML = `<span style="color:red;">Error: ${result.message || result.error}</span>`;
        }
    }catch(err){
        messageContainer.innerHTML = `<span style="color:red;">Connection Error: Unable to reach server</span>`;
    }
});
</script>
</body>
</html>
